# Руководство пользователя

## Обзор

Custom Auth — это система аутентификации и авторизации (RBAC) на Django + DRF с наглядным демо‑интерфейсом, JWT‑логином и отдельной админ‑панелью Django.

## Быстрый старт

### 1. Запуск системы (Docker — рекомендуется)

```bash
# Клонируйте репозиторий
git clone <repository-url>
cd custom_auth

# Запустите систему одной командой
docker-compose up --build
```

**Всё!** Система автоматически:
- ✅ Создаст PostgreSQL базу данных
- ✅ Применит все миграции
- ✅ Заполнит демо-данными
- ✅ Запустит веб-сервер

### 2. Альтернатива — локальная разработка

```bash
# Только для разработки
python manage.py migrate
python manage.py setup_demo_data
python manage.py runserver
```

### 3. Первый вход

1. Откройте http://localhost:8000
2. Нажмите кнопку "Админ" для автозаполнения
3. Нажмите "Войти"
4. Изучите панель управления

### 4. Управление Docker

#### **Основные команды:**
```bash
# Остановить систему
docker-compose down

# Перезапустить систему
docker-compose restart

# Просмотр логов
docker-compose logs -f web

# Выполнить команду в контейнере
docker-compose exec web python manage.py shell
```

#### **Управление данными:**
```bash
# Остановить и удалить все данные
docker-compose down -v

# Очистить и начать заново
docker-compose down -v
docker-compose up --build
```

## Веб‑интерфейс

### Страница входа (`/login/`)

#### Основные функции:
- **Ввод учетных данных** (email и пароль)
- **Автозаполнение** для демо-пользователей
- **Валидация** в реальном времени
- **Обработка ошибок** с понятными сообщениями

#### Демо‑пользователи:
- **Админ** - полный доступ ко всем функциям
- **Менеджер** - управление пользователями и ресурсами
- **Редактор** - создание и редактирование контента
- **Просмотр** - только чтение данных
- **Секреты** - доступ к конфиденциальной информации
- **Аналитик** - просмотр аналитических отчетов

#### Использование:
1. Введите email и пароль
2. Или нажмите кнопку демо-пользователя
3. Нажмите "Войти"
4. Система автоматически перенаправит на панель управления

### Страница регистрации (`/register/`)

#### Поля формы:
- **Имя** - обязательное поле
- **Фамилия** - обязательное поле
- **Email** - уникальный адрес электронной почты
- **Пароль** - минимум 8 символов, буквы и цифры
- **Подтверждение пароля** - должно совпадать с паролем

#### Требования к паролю:
- Минимум 8 символов
- Содержит буквы и цифры
- Не должен быть слишком простым

#### Использование:
1. Заполните все поля формы
2. Система проверит силу пароля в реальном времени
3. Нажмите "Зарегистрироваться"
4. После успешной регистрации вы будете перенаправлены на страницу входа

### Панель управления (`/dashboard/`)

#### Информация о пользователе:
- **Имя и фамилия** - отображается в заголовке
- **Email** - адрес электронной почты
- **Роли** - список назначенных ролей
- **Права** - детальный список разрешений

#### Быстрые действия:
- **Тестирование системы** - переход к демо-интерфейсу
- **API Документация** - просмотр Swagger документации
- **Админ панель** - управление системой
- **Тест API** - проверка доступности API

#### Навигация:
- **Демо-интерфейс** - кнопка для перехода к тестированию
- **Выйти** - безопасный выход из системы

## Демо‑интерфейс (`/detailed-demo/`)

### Вкладки интерфейса:

#### 1. Аутентификация
- **Вход в систему** с различными пользователями
- **Отображение информации** о текущем пользователе
- **Выход из системы**

#### 2. Панель управления
- **Статистика системы** (пользователи, роли, права)
- **Список ресурсов** с проверкой доступа
- **Информация о ролях и правах**

#### 3. Администрирование
- Управление ролями (создание, редактирование, удаление) — только для админов
- Управление правами (создание, редактирование, удаление) — только для админов

#### 4. Тестирование
- **Тестирование доступа к ресурсам** - проверка прав на все ресурсы
- **Визуальные индикаторы** доступа (✓ разрешено, ✗ запрещено)
- **Тестирование прав** - проверка конкретных разрешений

## Роли и права

### Роли пользователей:

#### **Администратор (admin)**
- **Полный доступ** ко всем функциям системы
- **Управление пользователями** - создание, редактирование, удаление
- **Управление ролями** - создание и настройка ролей
- **Управление правами** - назначение и отзыв разрешений
- **Доступ к админ-панели** Django

#### **Менеджер (manager)**
- Управление ресурсами — создание и редактирование
- Просмотр аналитики — доступ к отчетам

#### **Редактор (editor)**
- **Управление документами** - создание, редактирование, удаление
- **Управление ресурсами** - обновление контента
- **Просмотр пользователей** - базовая информация

#### **Просмотр (viewer)**
- **Только чтение** - просмотр данных без изменений
- **Документы** - чтение доступных документов
- **Пользователи** - просмотр списка пользователей
- **Ресурсы** - просмотр доступных ресурсов

#### **Читатель секретов (secret_reader)**
- **Доступ к секретной информации** - конфиденциальные данные
- **Специальные документы** - ограниченный доступ
- **Аудит безопасности** - просмотр логов доступа

#### **Аналитик (analyst)**
- **Просмотр аналитики** - отчеты и статистика
- **Аналитические ресурсы** - специальные данные
- **Метрики системы** - производительность и использование

### Права доступа:

#### **Управление документами:**
- `read_documents` - чтение документов
- `create_documents` - создание документов
- `update_documents` - редактирование документов
- `delete_documents` - удаление документов

#### **Управление пользователями:**
- `read_users` - просмотр пользователей
- `create_users` - создание пользователей
- `update_users` - редактирование пользователей
- `delete_users` - удаление пользователей
- `manage_users` - полное управление пользователями

#### **Управление ролями:**
- `read_roles` - просмотр ролей
- `create_roles` - создание ролей
- `update_roles` - редактирование ролей
- `delete_roles` - удаление ролей
- `manage_roles` - полное управление ролями

#### **Управление правами:**
- `read_permissions` - просмотр прав
- `create_permissions` - создание прав
- `update_permissions` - редактирование прав
- `delete_permissions` - удаление прав
- `manage_permissions` - полное управление правами

#### **Управление ресурсами:**
- `read_resources` - просмотр ресурсов
- `create_resources` - создание ресурсов
- `update_resources` - редактирование ресурсов
- `delete_resources` - удаление ресурсов
- `manage_resources` - полное управление ресурсами

#### **Специальный доступ:**
- `read_secrets` - доступ к секретной информации
- `admin_access` - административный доступ
- `view_analytics` - просмотр аналитики
- `manage_settings` - управление настройками

## API документация

### Доступ к документации
- **Swagger UI:** http://localhost:8000/api/docs/
- **JSON Schema:** http://localhost:8000/api/schema/

### Основные endpoints

#### **Аутентификация:**
- `POST /api/auth/register/` - регистрация пользователя
- `POST /api/auth/login/` - вход в систему
- `POST /api/auth/logout/` - выход из системы
- `POST /api/auth/refresh/` - обновление токена
- `GET /api/auth/profile/` - профиль пользователя

#### **Управление пользователями:**
- `GET /api/accounts/users/` - список пользователей
- `POST /api/accounts/users/` - создание пользователя
- `GET /api/accounts/users/{id}/` - информация о пользователе
- `PUT /api/accounts/users/{id}/` - обновление пользователя
- `DELETE /api/accounts/users/{id}/` - удаление пользователя

#### **Управление ролями:**
- `GET /api/authorization/roles/` - список ролей
- `POST /api/authorization/roles/` - создание роли
- `GET /api/authorization/roles/{id}/` - информация о роли
- `PUT /api/authorization/roles/{id}/` - обновление роли
- `DELETE /api/authorization/roles/{id}/` - удаление роли

#### **Управление правами:**
- `GET /api/authorization/permissions/` - список прав
- `POST /api/authorization/permissions/` - создание права
- `GET /api/authorization/permissions/{id}/` - информация о праве
- `PUT /api/authorization/permissions/{id}/` - обновление права
- `DELETE /api/authorization/permissions/{id}/` - удаление права

#### **Управление ресурсами:**
- `GET /api/resources/resources/` - список ресурсов
- `POST /api/resources/resources/` - создание ресурса
- `GET /api/resources/resources/{id}/` - информация о ресурсе
- `PUT /api/resources/resources/{id}/` - обновление ресурса
- `DELETE /api/resources/resources/{id}/` - удаление ресурса
- `GET /api/resources/test-access/{id}/` - тестирование доступа

## Безопасность

### JWT аутентификация
- **Access токены** - 15 минут жизни
- **Refresh токены** - 7 дней жизни
- **Автоматическое обновление** токенов
- **Безопасное хранение** в localStorage

### Защита маршрутов
- **Автоматические редиректы** для неавторизованных пользователей
- **Проверка прав** на уровне API
- **CSRF защита** для форм
- **Валидация** на клиенте и сервере

### Обработка ошибок
- **401 Unauthorized** - неверные учетные данные
- **403 Forbidden** - недостаточно прав
- **404 Not Found** - ресурс не найден
- **500 Internal Server Error** - ошибка сервера

## Устранение неполадок

### Проблемы с входом
1. **Проверьте учетные данные** - используйте демо-пользователей
2. **Очистите localStorage** - удалите старые токены
3. **Проверьте консоль браузера** - найдите ошибки JavaScript

### Проблемы с доступом
1. **Проверьте роли пользователя** - в панели управления
2. **Проверьте права** - в разделе тестирования
3. **Обратитесь к администратору** - для изменения ролей

### Проблемы с API
1. **Проверьте токен** - в заголовке Authorization
2. **Проверьте права** - для конкретного endpoint
3. **Изучите документацию** - в Swagger UI

## Поддержка

### Документация
- **README.md** - общая информация о проекте
- **RBAC_SCHEMA.md** - схема базы данных
- **USER_GUIDE.md** - данное руководство пользователя

### Контакты:
- **GitHub Issues** - для сообщений об ошибках
- **Документация API** - в Swagger UI
- **Логи системы** - в консоли Docker

---

**Custom Auth System** - профессиональная система аутентификации и авторизации с современным веб-интерфейсом и полной поддержкой RBAC.
